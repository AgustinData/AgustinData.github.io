 # Conexión a VPN con OpenVPN en Kali Linux

**Plataforma:** TryHackMe | **Creador Original:** Josiah Pierce (VulnHub)
**Fecha de Realización:** 09/Noviembre/2025
**Objetivo:** Obtener privilegios de root (acceso total) en la máquina objetivo y demostrar el compromiso del sistema.

## 1. Introducción y Objetivos del Laboratorio

Este informe documenta el proceso de prueba de penetración llevado a cabo contra la máquina virtual "[Nombre del Lab]". El objetivo principal de este ejercicio es aplicar la metodología estándar de pruebas de penetración para identificar, explotar y escalar privilegios dentro de un entorno controlado.

### Objetivos de Aprendizaje

El foco de este laboratorio está en el desarrollo y la demostración de las siguientes habilidades clave de un analista ofensivo:

| Habilidad Técnica | Descripción |
|---|---|
| Enumeración de Servicios (Service Enumeration) | Identificar todos los servicios activos y sus versiones (HTTP, FTP, SSH, etc.) para buscar vulnerabilidades conocidas. |
| Fuerza Bruta (Brute Forcing) | Utilizar diccionarios para descifrar credenciales o contenidos ocultos en puntos de acceso específicos. |
| Cracking de Hash (Hash Cracking) | Obtener hashes de contraseñas de usuarios del sistema y utilizar herramientas como Hashcat o John The Ripper para descifrarlos. |
| Enumeración Linux (Linux Enumeration) | Realizar una auditoría interna del sistema comprometido para identificar vectores de escalada de privilegios. |

### Diagrama de la Topología (Setup)

**Máquina Atacante (Blue Team):** Kali Linux (Mi VM Personal)
**Máquina Víctima (Red Team):** Máquina virtual [Nombre del Lab]
**Conexión:** Red VPN de TryHackMe (OpenVPN)

## 2. Fase de Conexión y Setup Inicial

Antes de iniciar cualquier escaneo o ataque, fue esencial establecer una conexión segura y privada a la red del laboratorio mediante OpenVPN.

### 2.1. Configuración de Acceso (OpenVPN)

1. **Selección del Servidor:** Se eligió el servidor **[US-East-Regular-1]** de la red de TryHackMe para asegurar la menor latencia posible desde mi ubicación.
2. **Descarga y Conexión:** El archivo de configuración (`[agusrodriguez.2401.ovpn]`) fue descargado y ejecutado en la terminal de mi máquina Kali Linux:

~~~bash
cd ~/Downloads    # Navego hasta el directorio donde se guardó el archivo
sudo openvpn agusrodriguez.2401.ovpn
~~~

3. **Verificación:** La conexión fue verificada en la página de TryHackMe (Conexión: Conectado) y comprobada en la terminal de Kali, confirmando el establecimiento de la secuencia.

## 3. Reconocimiento y Escaneo

El primer paso tras establecer la conexión a la red del laboratorio fue identificar los servicios y puertos expuestos en la máquina objetivo. La IP proporcionada por el laboratorio fue: `10.201.51.84`.

### 3.1 Escaneo inicial con Nmap

Se ejecutó un escaneo básico para listar puertos abiertos:

```bash
nmap 10.201.51.84
```
### 3.2 Extraer los números de puerto y volcarlos a un fichero

Para automatizar el siguiente paso (por ejemplo, lanzar escaneos o ataques puntuales contra puertos concretos), extraje solo los números de puerto abiertos y los guardé en un fichero port.txt. El pipeline utilizado fue:

```bash
nmap 10.201.51.84 | grep "/tcp" | cut -d'/' -f1 | tr '\n' ',' | sed 's/,$//' > port.txt
```


**Explicación breve y ordenada del pipeline:**

- nmap 10.201.51.84 — realiza el escaneo y genera la salida que contiene líneas como 22/tcp open ssh.

- grep "/tcp" — filtra únicamente las líneas que describen puertos TCP (evita información irrelevante).

- cut -d'/' -f1 — divide cada línea por la barra / y selecciona el primer campo (el número de puerto). Ej.: 22/tcp → 22.

- tr '\n' ',' — reemplaza los saltos de línea por comas, transformando la lista vertical en una lista separada por comas: 22,80,139,....

- sed 's/,$//' — elimina la coma final sobrante si la hubiera.

- > port.txt — redirige la salida final al fichero port.txt.

### 3.3 Verificar el contenido generado

Para comprobar que el fichero port.txt contiene la lista esperada:

```bash
cat port.txt
# salida esperada de ejemplo:
# 22,80,139,445,8009,8080
```

### 3.4 Escaneo profundo (detección de versiones y scripts)

Para obtener información más detallada sobre los servicios detectados en el escaneo inicial, ejecuté un escaneo más exhaustivo sobre la lista de puertos previamente extraída. Este escaneo emplea un *SYN stealth scan* combinado con la detección de versiones y la ejecución de los scripts NSE por defecto:

```bash
# Escaneo "silencioso" (SYN) + detección de versiones + scripts por defecto sobre los puertos listados en port.txt
nmap -sS -sV -sC -p$(cat port.txt) 10.201.51.84
```

**Descripción de las opciones usadas:**

- -sS : SYN scan (escaneo tipo "stealth").

- -sV : detección de versión del servicio (intenta identificar el software y su versión).

- -sC : ejecuta los scripts NSE por defecto (útil para obtener información de servicios y pequeños chequeos de seguridad).

- -p$(cat port.txt) : utiliza la lista de puertos guardada en port.txt (evita escanear puertos no relevantes).

### 3.5 Resultados del escaneo profundo (resumen)

A partir de la salida del comando (ver captura insertada más arriba), se obtuvieron las siguientes observaciones relevantes:

- 22/tcp – ssh
  - Servicio: OpenSSH 8.2p1 (Ubuntu)
  - Observación: el banner muestra la versión del servidor SSH; esta información es útil para buscar vulnerabilidades específicas de la versión o comprobar políticas de cifrado/host-keys.

- 80/tcp – http
  - Servicio: Apache httpd 2.4.41 (Ubuntu)
  - Observación: header del servidor indica Apache sobre Ubuntu. Conviene revisar el contenido web, archivos expuestos y posibles vectores de LFI/RFI o vulnerabilidades de aplicaciones.

- 139/tcp y 445/tcp – netbios-ssn / smb
  - Servicio: Samba smbd 4
  - Observación: puertos SMB abiertos; si los servicios están activos pueden ofrecer directorios/recursos compartidos o información filtrada sobre usuarios y rutas.

- 8009/tcp – ajp13
  - Servicio: Apache Jserv (AJP) v1.3
  - Observación: AJP es un conector usado por Tomcat; en ciertas versiones/configuraciones puede permitir el envío de peticiones a la aplicación web (posibles vectores de exposición).

- 8080/tcp – http (Tomcat)
  - Servicio: Apache Tomcat 9.0.7
  - Observación: servidor de aplicaciones Tomcat identificado; revisar manager/administrador expuesto, cabeceras y posibles vulnerabilidades de deserialización o configuración.
 
## 4. Acceso Web y Enumeración de Directorios

Tras identificar servicios HTTP en los puertos detectados (por ejemplo `80/tcp` y `8080/tcp`), procedí a **abrir la IP objetivo en un navegador** para inspeccionar el contenido web disponible y el código fuente. El objetivo de abrir la web fue confirmar visualmente si hay una aplicación web, identificar mensajes, errores o pistas en el HTML, y obtener ideas sobre posibles directorios o archivos expuestos.

**Motivo:** si una web está presente, muchas veces contiene pistas (mensajes, comentarios HTML, `robots.txt`, títulos, comentarios de desarrollador) que orientan la siguiente etapa de enumeración. Además, la presencia de servicios como Apache/Tomcat sugiere examinar rutas típicas de aplicaciones web.

### 4.1 Inspección inicial y análisis del código fuente

Al abrir la web no se mostró contenido útil visible inicialmente; por eso inspeccioné el **código fuente** de la página. En el HTML apareció el mensaje:

> _"check our dev note section if you need to know what to work on"_

La referencia explícita a la palabra **`dev`** sugirió la posible existencia de un directorio o sección `/development` o `/dev` dentro del sitio. Este tipo de pistas en el contenido público son indicadores valiosos para orientar búsquedas de directorios ocultos o en mantenimiento.

### 4.2 Enumeración de directorios con Gobuster

Dado que no sabía qué había dentro del servidor web, ejecuté una enumeración de directorios para buscar rutas accesibles y ficheros que pudieran contener información sensible o pistas adicionales:

```bash
gobuster dir -u http://10.201.51.84/ -w /usr/share/wordlists/dirb/common.txt
```

- -u : URL objetivo.

- -w : wordlist usada (en este caso dirb/common.txt) para probar nombres de directorios y archivos comunes.

**Resultado relevante:** Gobuster encontró el directorio development (o development/). Al acceder a ese directorio se localizaron dos archivos llamativos: dev.txt y j.txt. Inserte la captura de la ejecución de Gobuster y/o del listado de directorios aquí:

### 4.3 Contenido de los ficheros encontrados

- j.txt (fragmento relevante):

> _For J:
I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.
-K
_
